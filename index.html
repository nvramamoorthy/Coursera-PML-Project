<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=640">

    <link rel="stylesheet" href="stylesheets/core.css" media="screen">
    <link rel="stylesheet" href="stylesheets/mobile.css" media="handheld, only screen and (max-device-width:640px)">
    <link rel="stylesheet" href="stylesheets/github-light.css">

    <script type="text/javascript" src="javascripts/modernizr.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="javascripts/headsmart.min.js"></script>
    <script type="text/javascript">
      $(document).ready(function () {
        $('#main_content').headsmart()
      })
    </script>
    <title>Coursera-pml-project by nvramamoorthy</title>
  </head>

  <body>
    <a id="forkme_banner" href="https://github.com/nvramamoorthy/Coursera-PML-Project">View on GitHub</a>
    <div class="shell">

      <header>
        <span class="ribbon-outer">
          <span class="ribbon-inner">
            <h1>Coursera-pml-project</h1>
            <h2>This repository is for Coursera Project,  &#39;Practical Machine Learning&#39;   offered by Johns Hopkins Bloomberg School of of Public Health.</h2>
          </span>
          <span class="left-tail"></span>
          <span class="right-tail"></span>
        </span>
      </header>

      <section id="downloads">
        <span class="inner">
          <a href="https://github.com/nvramamoorthy/Coursera-PML-Project/zipball/master" class="zip"><em>download</em> .ZIP</a><a href="https://github.com/nvramamoorthy/Coursera-PML-Project/tarball/master" class="tgz"><em>download</em> .TGZ</a>
        </span>
      </section>


      <span class="banner-fix"></span>


      <section id="main_content">
        <h1>
<a id="coursera--practical-machine-learning-project---prediction-model" class="anchor" href="#coursera--practical-machine-learning-project---prediction-model" aria-hidden="true"><span class="octicon octicon-link"></span></a>Coursera : Practical Machine Learning Project - Prediction Model</h1>

<p>nvramamoorthy<br>
14 June 2015  </p>

<h3>
<a id="synopsis" class="anchor" href="#synopsis" aria-hidden="true"><span class="octicon octicon-link"></span></a>Synopsis</h3>

<p>The project is about HAR - Human Activity Recognition , where 6  participants were asked to perform barbell lifts correctly and incorrectly in 5 different ways and the relevant data were collected using the devices like  Jawbone Up, Nike FuelBand, and Fitbit which were worn by the paricipants.</p>

<p>The participant  normally  quantify how much of a particular activity they do, but they rarely quantify how well they do it. </p>

<p>Six young health participants were asked to perform one set of 10 repetitions of the Unilateral Dumbbell Biceps Curl in five different fashions: exactly according to the specification (Class A), throwing the elbows to the front (Class B), lifting the dumbbell only halfway (Class C), lowering the dumbbell only halfway (Class D) and throwing the hips to the front (Class E).</p>

<p>The goal is  to assess whether we could detect mistakes in weight-lifting exercises by using activity recognition techniques. we recorded users performing the same activity correctly and with a set of common mistakes with wearable sensors and used machine learning to classify each mistake. </p>

<p>This way, we used the training data as the activity specification and the classification algorithm as the means to compare the execution to the specification.</p>

<p>Our aim is to build a prediction model algorithm , cross validate and find the out of sample error. </p>

<p>We tested the prediction model on 20 different Test cases and submitted the result as required.</p>

<p>The following sections deals with all data processing steps done for building the model and testing them.</p>

<h3>
<a id="initial-setup" class="anchor" href="#initial-setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Initial Setup</h3>

<h4>
<a id="environment" class="anchor" href="#environment" aria-hidden="true"><span class="octicon octicon-link"></span></a>Environment</h4>

<h5>
<a id="hardware-" class="anchor" href="#hardware-" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hardware :</h5>

<pre><code>            Macbook Pro with OSX Yosemite 10.10.4
</code></pre>

<h5>
<a id="software-" class="anchor" href="#software-" aria-hidden="true"><span class="octicon octicon-link"></span></a>Software :</h5>

<pre><code>            RStudio 

            GitHub DeskTop / Web Version
</code></pre>

<h3>
<a id="data-processing" class="anchor" href="#data-processing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Data Processing</h3>

<h4>
<a id="setting-up-working-directory" class="anchor" href="#setting-up-working-directory" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setting up working directory:</h4>

<div class="highlight highlight-r"><pre>setwd(<span class="pl-s"><span class="pl-pds">"</span>~/Desktop/Machine Learning/Coursera-PML-Project<span class="pl-pds">"</span></span>)</pre></div>

<p>The required R Packeges were installed.</p>

<div class="highlight highlight-r"><pre>library(<span class="pl-smi">caret</span>)</pre></div>

<pre><code>## Loading required package: lattice
## Loading required package: ggplot2
</code></pre>

<div class="highlight highlight-r"><pre>library(<span class="pl-smi">rpart</span>)
library(<span class="pl-smi">rpart.plot</span>)
library(<span class="pl-smi">randomForest</span>)</pre></div>

<pre><code>## randomForest 4.6-10
## Type rfNews() to see new features/changes/bug fixes.
</code></pre>

<div class="highlight highlight-r"><pre>library(<span class="pl-smi">corrplot</span>)</pre></div>

<h4>
<a id="download-the-data----" class="anchor" href="#download-the-data----" aria-hidden="true"><span class="octicon octicon-link"></span></a>Download the Data    :</h4>

<pre><code>        The training and test data were downloaded as instructed.
        Trainig Data : pml-training.csv 
        Test data    : pml-testing.csv
</code></pre>

<div class="highlight highlight-r"><pre><span class="pl-smi">trainUrl</span> <span class="pl-k">&lt;-</span><span class="pl-s"><span class="pl-pds">"</span>https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv<span class="pl-pds">"</span></span>
<span class="pl-smi">testUrl</span> <span class="pl-k">&lt;-</span> <span class="pl-s"><span class="pl-pds">"</span>https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv<span class="pl-pds">"</span></span>
<span class="pl-smi">trainFile</span> <span class="pl-k">&lt;-</span> <span class="pl-s"><span class="pl-pds">"</span>./data/pml-training.csv<span class="pl-pds">"</span></span>
<span class="pl-smi">testFile</span>  <span class="pl-k">&lt;-</span> <span class="pl-s"><span class="pl-pds">"</span>./data/pml-testing.csv<span class="pl-pds">"</span></span>
<span class="pl-k">if</span> (<span class="pl-k">!</span>file.exists(<span class="pl-s"><span class="pl-pds">"</span>./data<span class="pl-pds">"</span></span>)) {
  dir.create(<span class="pl-s"><span class="pl-pds">"</span>./data<span class="pl-pds">"</span></span>)
}
<span class="pl-k">if</span> (<span class="pl-k">!</span>file.exists(<span class="pl-smi">trainFile</span>)) {
  download.file(<span class="pl-smi">trainUrl</span>, <span class="pl-v">destfile</span><span class="pl-k">=</span><span class="pl-smi">trainFile</span>, <span class="pl-v">method</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>curl<span class="pl-pds">"</span></span>)
}
<span class="pl-k">if</span> (<span class="pl-k">!</span>file.exists(<span class="pl-smi">testFile</span>)) {
  download.file(<span class="pl-smi">testUrl</span>, <span class="pl-v">destfile</span><span class="pl-k">=</span><span class="pl-smi">testFile</span>, <span class="pl-v">method</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>curl<span class="pl-pds">"</span></span>)
}</pre></div>

<h4>
<a id="read-the-data-into-dataframes-and-check-for-the-content" class="anchor" href="#read-the-data-into-dataframes-and-check-for-the-content" aria-hidden="true"><span class="octicon octicon-link"></span></a>Read the data into Dataframes and check for the content:</h4>

<div class="highlight highlight-r"><pre><span class="pl-smi">trainRaw</span> <span class="pl-k">&lt;-</span> read.csv(<span class="pl-s"><span class="pl-pds">"</span>./data/pml-training.csv<span class="pl-pds">"</span></span>)
<span class="pl-smi">testRaw</span> <span class="pl-k">&lt;-</span> read.csv(<span class="pl-s"><span class="pl-pds">"</span>./data/pml-testing.csv<span class="pl-pds">"</span></span>)
dim(<span class="pl-smi">trainRaw</span>)</pre></div>

<pre><code>## [1] 19622   160
</code></pre>

<div class="highlight highlight-r"><pre>dim(<span class="pl-smi">testRaw</span>)</pre></div>

<pre><code>## [1]  20 160
</code></pre>

<h4>
<a id="cleaning-the-data-" class="anchor" href="#cleaning-the-data-" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cleaning the Data :</h4>

<p>On inspecting both traing and test the dataset, some missing data  and unwated data were found which were to be cleaned.</p>

<div class="highlight highlight-r"><pre>sum(complete.cases(<span class="pl-smi">trainRaw</span>))</pre></div>

<pre><code>## [1] 406
</code></pre>

<p>The columns containing NA were replaced with 0:</p>

<div class="highlight highlight-r"><pre><span class="pl-smi">trainRaw</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">trainRaw</span>[, colSums(is.na(<span class="pl-smi">trainRaw</span>)) <span class="pl-k">==</span> <span class="pl-c1">0</span>] 
<span class="pl-smi">testRaw</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">testRaw</span>[, colSums(is.na(<span class="pl-smi">testRaw</span>)) <span class="pl-k">==</span> <span class="pl-c1">0</span>] </pre></div>

<p>Few columns where those  data do not have any meaning with the measurements data were removed.</p>

<div class="highlight highlight-r"><pre><span class="pl-smi">classe</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">trainRaw</span><span class="pl-k">$</span><span class="pl-smi">classe</span>
<span class="pl-smi">trainRemove</span> <span class="pl-k">&lt;-</span> grepl(<span class="pl-s"><span class="pl-pds">"</span>^X|timestamp|window<span class="pl-pds">"</span></span>, names(<span class="pl-smi">trainRaw</span>))
<span class="pl-smi">trainRaw</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">trainRaw</span>[, <span class="pl-k">!</span><span class="pl-smi">trainRemove</span>]
<span class="pl-smi">trainCleaned</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">trainRaw</span>[, sapply(<span class="pl-smi">trainRaw</span>, <span class="pl-smi">is.numeric</span>)]
<span class="pl-smi">trainCleaned</span><span class="pl-k">$</span><span class="pl-smi">classe</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">classe</span>
<span class="pl-smi">testRemove</span> <span class="pl-k">&lt;-</span> grepl(<span class="pl-s"><span class="pl-pds">"</span>^X|timestamp|window<span class="pl-pds">"</span></span>, names(<span class="pl-smi">testRaw</span>))
<span class="pl-smi">testRaw</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">testRaw</span>[, <span class="pl-k">!</span><span class="pl-smi">testRemove</span>]
<span class="pl-smi">testCleaned</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">testRaw</span>[, sapply(<span class="pl-smi">testRaw</span>, <span class="pl-smi">is.numeric</span>)]</pre></div>

<p>Raw training data contained 19622 rows and 160 variable columns. The cleaned training data set now contains 19622 observations and 53 variables columns only, while the testing data set contains 20 observations and 53 variables. The "classe" variable is still in the cleaned training set.</p>

<h4>
<a id="slicing-the-data" class="anchor" href="#slicing-the-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Slicing the data:</h4>

<p>Then, we can split the cleaned training set into a pure training data set (70%) and a validation data set (30%). We will use the validation data set to conduct cross validation in future steps. </p>

<div class="highlight highlight-r"><pre>set.seed(<span class="pl-c1">22519</span>) <span class="pl-c"># For Reproducible purpose</span>
<span class="pl-smi">inTrain</span> <span class="pl-k">&lt;-</span> createDataPartition(<span class="pl-smi">trainCleaned</span><span class="pl-k">$</span><span class="pl-smi">classe</span>, <span class="pl-v">p</span><span class="pl-k">=</span><span class="pl-c1">0.70</span>, <span class="pl-v">list</span><span class="pl-k">=</span><span class="pl-c1">F</span>)
<span class="pl-smi">trainData</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">trainCleaned</span>[<span class="pl-smi">inTrain</span>, ]
<span class="pl-smi">testData</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">trainCleaned</span>[<span class="pl-k">-</span><span class="pl-smi">inTrain</span>, ]</pre></div>

<h4>
<a id="data-modeling" class="anchor" href="#data-modeling" aria-hidden="true"><span class="octicon octicon-link"></span></a>Data Modeling:</h4>

<p>We fit a predictive model for activity recognition using Random Forest algorithm because it automatically selects important variables and is robust to correlated covariates &amp; outliers in general. We will use 5-fold cross validation when applying the algorithm. </p>

<div class="highlight highlight-r"><pre><span class="pl-smi">controlRf</span> <span class="pl-k">&lt;-</span> trainControl(<span class="pl-v">method</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>cv<span class="pl-pds">"</span></span>, <span class="pl-c1">5</span>)
<span class="pl-smi">modelRf</span> <span class="pl-k">&lt;-</span> train(<span class="pl-smi">classe</span> <span class="pl-k">~</span> ., <span class="pl-v">data</span><span class="pl-k">=</span><span class="pl-smi">trainData</span>, <span class="pl-v">method</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>rf<span class="pl-pds">"</span></span>, <span class="pl-v">trControl</span><span class="pl-k">=</span><span class="pl-smi">controlRf</span>, <span class="pl-v">ntree</span><span class="pl-k">=</span><span class="pl-c1">250</span>)
<span class="pl-smi">modelRf</span></pre></div>

<pre><code>## Random Forest 
## 
## 13737 samples
##    52 predictor
##     5 classes: 'A', 'B', 'C', 'D', 'E' 
## 
## No pre-processing
## Resampling: Cross-Validated (5 fold) 
## 
## Summary of sample sizes: 10989, 10989, 10991, 10990, 10989 
## 
## Resampling results across tuning parameters:
## 
##   mtry  Accuracy   Kappa      Accuracy SD  Kappa SD   
##    2    0.9910462  0.9886729  0.001301269  0.001647776
##   27    0.9914102  0.9891334  0.001717547  0.002174708
##   52    0.9850037  0.9810264  0.002718384  0.003439965
## 
## Accuracy was used to select the optimal model using  the largest value.
## The final value used for the model was mtry = 27.
</code></pre>

<p>The performance of the model on the validation data set is estimated.</p>

<div class="highlight highlight-r"><pre><span class="pl-smi">predictRf</span> <span class="pl-k">&lt;-</span> predict(<span class="pl-smi">modelRf</span>, <span class="pl-smi">testData</span>)
confusionMatrix(<span class="pl-smi">testData</span><span class="pl-k">$</span><span class="pl-smi">classe</span>, <span class="pl-smi">predictRf</span>)</pre></div>

<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction    A    B    C    D    E
##          A 1672    1    0    0    1
##          B    7 1128    4    0    0
##          C    0    0 1021    5    0
##          D    0    0   14  949    1
##          E    0    0    1    7 1074
## 
## Overall Statistics
##                                          
##                Accuracy : 0.993          
##                  95% CI : (0.9906, 0.995)
##     No Information Rate : 0.2853         
##     P-Value [Acc &gt; NIR] : &lt; 2.2e-16      
##                                          
##                   Kappa : 0.9912         
##  Mcnemar's Test P-Value : NA             
## 
## Statistics by Class:
## 
##                      Class: A Class: B Class: C Class: D Class: E
## Sensitivity            0.9958   0.9991   0.9817   0.9875   0.9981
## Specificity            0.9995   0.9977   0.9990   0.9970   0.9983
## Pos Pred Value         0.9988   0.9903   0.9951   0.9844   0.9926
## Neg Pred Value         0.9983   0.9998   0.9961   0.9976   0.9996
## Prevalence             0.2853   0.1918   0.1767   0.1633   0.1828
## Detection Rate         0.2841   0.1917   0.1735   0.1613   0.1825
## Detection Prevalence   0.2845   0.1935   0.1743   0.1638   0.1839
## Balanced Accuracy      0.9977   0.9984   0.9903   0.9922   0.9982
</code></pre>

<div class="highlight highlight-r"><pre><span class="pl-smi">accuracy</span> <span class="pl-k">&lt;-</span> postResample(<span class="pl-smi">predictRf</span>, <span class="pl-smi">testData</span><span class="pl-k">$</span><span class="pl-smi">classe</span>)
<span class="pl-smi">accuracy</span></pre></div>

<pre><code>##  Accuracy     Kappa 
## 0.9930331 0.9911872
</code></pre>

<div class="highlight highlight-r"><pre><span class="pl-smi">outSampErr</span> <span class="pl-k">&lt;-</span> <span class="pl-c1">1</span> <span class="pl-k">-</span> as.numeric(confusionMatrix(<span class="pl-smi">testData</span><span class="pl-k">$</span><span class="pl-smi">classe</span>, <span class="pl-smi">predictRf</span>)<span class="pl-k">$</span><span class="pl-smi">overall</span>[<span class="pl-c1">1</span>])
<span class="pl-smi">outSampErr</span></pre></div>

<pre><code>## [1] 0.006966865
</code></pre>

<p>The accuracy of the model is estimated as 99.30 %  and out of sample error of 0.69 % is estimated.</p>

<h4>
<a id="predicting-for-test-data-set" class="anchor" href="#predicting-for-test-data-set" aria-hidden="true"><span class="octicon octicon-link"></span></a>Predicting for Test Data Set:</h4>

<p>Finally  we apply the model to the original testing data set downloaded from the data source. We remove the problem_id column first. </p>

<div class="highlight highlight-r"><pre><span class="pl-smi">result</span> <span class="pl-k">&lt;-</span> predict(<span class="pl-smi">modelRf</span>, <span class="pl-smi">testCleaned</span>[, <span class="pl-k">-</span>length(names(<span class="pl-smi">testCleaned</span>))])
<span class="pl-smi">result</span></pre></div>

<pre><code>##  [1] B A B A A E D B A A B C B A E E A B B B
## Levels: A B C D E
</code></pre>

<h3>
<a id="conclusion" class="anchor" href="#conclusion" aria-hidden="true"><span class="octicon octicon-link"></span></a>Conclusion</h3>

<h5>
<a id="it-is-found-that-the-accuracy-of-the-model-is--9930-and-out-of-sample-error-is--069-" class="anchor" href="#it-is-found-that-the-accuracy-of-the-model-is--9930-and-out-of-sample-error-is--069-" aria-hidden="true"><span class="octicon octicon-link"></span></a>It is found that the accuracy of the model is  99.30% and out of sample error is  0.69% .</h5>

<p>The prediction model was tested on 20 test cases and results were submitted as required</p>

<p>Plots are available in the folder 'writeup_files/figure-html' in th GitHub Repository and appended in Appendix.</p>

<p>I acknowledge my thanks to the Coursera team and course participants for giving this opporunity to enrich my knowledge by doing this interesting project.</p>

<p>I also thank HAR data provider for this excercise.</p>

<h3>
<a id="appendix-" class="anchor" href="#appendix-" aria-hidden="true"><span class="octicon octicon-link"></span></a>Appendix :</h3>

<h5>
<a id="plot-1--decision-tree-visualization" class="anchor" href="#plot-1--decision-tree-visualization" aria-hidden="true"><span class="octicon octicon-link"></span></a>Plot 1 : Decision Tree Visualization</h5>

<div class="highlight highlight-r"><pre><span class="pl-smi">treeModel</span> <span class="pl-k">&lt;-</span> rpart(<span class="pl-smi">classe</span> <span class="pl-k">~</span> ., <span class="pl-v">data</span><span class="pl-k">=</span><span class="pl-smi">trainData</span>, <span class="pl-v">method</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>class<span class="pl-pds">"</span></span>)
prp(<span class="pl-smi">treeModel</span>) </pre></div>

<p><img src="writeup_files/figure-html/unnamed-chunk-13-1.png" alt=""> </p>

<h5>
<a id="plot-2--correlation-matrix-visualization" class="anchor" href="#plot-2--correlation-matrix-visualization" aria-hidden="true"><span class="octicon octicon-link"></span></a>Plot 2 : Correlation Matrix Visualization</h5>

<div class="highlight highlight-r"><pre><span class="pl-smi">corrPlot</span> <span class="pl-k">&lt;-</span> cor(<span class="pl-smi">trainData</span>[, <span class="pl-k">-</span>length(names(<span class="pl-smi">trainData</span>))])
corrplot(<span class="pl-smi">corrPlot</span>, <span class="pl-v">method</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>color<span class="pl-pds">"</span></span>)</pre></div>

<p><img src="writeup_files/figure-html/unnamed-chunk-14-1.png" alt=""> </p>
      </section>

      <footer>
        <span class="ribbon-outer">
          <span class="ribbon-inner">
            <p>this project by <a href="https://github.com/nvramamoorthy">nvramamoorthy</a> can be found on <a href="https://github.com/nvramamoorthy/Coursera-PML-Project">GitHub</a></p>
          </span>
          <span class="left-tail"></span>
          <span class="right-tail"></span>
        </span>
        <p>Generated with <a href="https://pages.github.com">GitHub Pages</a> using Merlot</p>
        <span class="octocat"></span>
      </footer>

    </div>

    
  </body>
</html>
